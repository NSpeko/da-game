!function(e){var t={};function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(s,r,function(t){return e[t]}.bind(null,r));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";n.r(t),n.d(t,"PLAYER_PATH",function(){return D}),n.d(t,"rebuildCanvas",function(){return u}),n.d(t,"PLAYER_FEMALE_NUM",function(){return W}),n.d(t,"PLAYER_MALE_NUM",function(){return G}),n.d(t,"TASKSLIST",function(){return U}),n.d(t,"MAX_COUNTING_NUM",function(){return j}),n.d(t,"SIGN_ARRAY",function(){return K}),n.d(t,"MODAL_DELATION",function(){return J}),n.d(t,"SPEECH_DELATION",function(){return q}),n.d(t,"PLAYER",function(){return PLAYER}),n.d(t,"ENEMY",function(){return ENEMY}),n.d(t,"HEAL",function(){return B}),n.d(t,"ATTACK",function(){return v}),n.d(t,"ENEMY_PATH",function(){return R}),n.d(t,"SPELL_IMAGE_PATH",function(){return k}),n.d(t,"SPELL_SOUND_PATH",function(){return Y}),n.d(t,"MAX_HEAL_POINTS",function(){return $}),n.d(t,"TOP_COUNT",function(){return V}),n.d(t,"WRAP",function(){return H}),n.d(t,"VERTICAL_WRAP",function(){return w}),n.d(t,"spellCanvas",function(){return s}),n.d(t,"spellContext",function(){return r}),n.d(t,"actorsCanvas",function(){return o}),n.d(t,"actorsContext",function(){return a}),n.d(t,"CANVAS_WIDTH",function(){return i}),n.d(t,"PX",function(){return d}),n.d(t,"CANVAS_HEIGHT",function(){return c}),n.d(t,"NAME_SIZE",function(){return M}),n.d(t,"HP_WRAP_PLAYER",function(){return N}),n.d(t,"NAME_WRAP_PLAYER",function(){return L}),n.d(t,"NAME_WRAP_ENEMY",function(){return x}),n.d(t,"HP_WRAP_ENEMY",function(){return C}),n.d(t,"HP_LINE_HEIGHT",function(){return X}),n.d(t,"EFFECT_DURATION",function(){return b}),n.d(t,"LVL_SIZE",function(){return S}),n.d(t,"LVL_WRAP",function(){return O}),n.d(t,"PLAYER_WIDTH",function(){return h}),n.d(t,"PLAYER_HEIGHT",function(){return g}),n.d(t,"ENEMY_WIDTH",function(){return m}),n.d(t,"ENEMY_HEIGHT",function(){return E}),n.d(t,"HEAD_WIDTH",function(){return p}),n.d(t,"HEAD_HEIGHT",function(){return _}),n.d(t,"BODY_WIDTH",function(){return P}),n.d(t,"BODY_HEIGHT",function(){return A}),n.d(t,"WEAPON_WIDTH",function(){return y}),n.d(t,"WEAPON_HEIGHT",function(){return f}),n.d(t,"LEGS_WIDTH",function(){return I}),n.d(t,"LEGS_HEIGHT",function(){return T}),n.d(t,"KEYBOARDEVENT",function(){return F});const s=document.getElementById("spellCanvas"),r=s.getContext("2d"),o=document.getElementById("actors"),a=o.getContext("2d");let i=document.getElementById("gameWindow").offsetWidth,c=350;o.style.marginLeft=`-${i}px`;const l=()=>i/800;let d=l();function u(){i=document.getElementById("gameWindow").offsetWidth,d=l(),c=350*d,o.style.marginLeft=`-${i}px`,s.width=i,s.height=c,o.width=i,o.height=c}const h=150,g=150,m=1.3*h,E=1.3*g,p=m/2.5,_=E/2.5,P=m,A=E/2,y=m/2,f=E/2,I=m/1.25,T=E/1.5,H=40,w=30,N=50,L=15,C=65,x=30,M=18,X=10,b=50,S=50,O=10,R="../resources/images/enemy",D="../resources/images/player",W=1,G=2,k="../resources/images/spell/",Y="../resources/audio/spell/",$=310,B=30,v=60,V=10,U=["counting","translation","speech"],j=20,K=["-","+","*"],F={ENTER:13},J=2e3,q=800},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return countingTask});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0);const countingTask=()=>{const signArray=_constants__WEBPACK_IMPORTED_MODULE_0__.SIGN_ARRAY,sign=signArray[Math.floor(Math.random()*signArray.length)],firstNum=getRandomCountNum(_constants__WEBPACK_IMPORTED_MODULE_0__.MAX_COUNTING_NUM),secondNum=getRandomCountNum(_constants__WEBPACK_IMPORTED_MODULE_0__.MAX_COUNTING_NUM),task=`${firstNum} ${sign} ${secondNum}`,answer=eval(task);return[task,answer]},getRandomCountNum=e=>Math.round(Math.random()*e)},function(e,t,n){"use strict";n.r(t);const s=e=>new Promise(t=>{const n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(){200===this.status&&t(this.response)},n.send()});var r=n(0);let o=[];class a{constructor(e,t,n,s,a,i,c){this.name=e,this.image=new Image,this.image.src=`${r.SPELL_IMAGE_PATH}${t}`,this.sound=new Audio(`${r.SPELL_SOUND_PATH}${n}`),this.width=s,this.height=a,this.step={x:i,y:c},o.push(this)}}new class extends a{constructor(e,t,n,s,r,o,a){super(e,t,n,s,r,o,a),this.type="flying"}}("Fireball","fireball.png","fireball.ogg",100,100,10,20),new class extends a{constructor(e,t,n,s,r,o,a){super(e,t,n,s,r,0,o),this.type="drop"}}("Meteor","meteor.png","meteor.ogg",200,200,12),new class extends a{constructor(e,t,n,s,r,o,a){super(e,t,n,s,r,o,0),this.type="straight"}}("Arrow","arrow.png","arrow.ogg",100,100,12),new class extends a{constructor(e,t,n,s,r,o,a){super(e,t,n,s,r,o,a),this.type="jiggling"}}("Star","star.png","star.ogg",100,100,12,8),new class extends a{constructor(e,t,n,s,r,o,a){super(e,t,n,s,r,0,0),this.type="heal"}}("Heal","heal.png","heal.ogg",200,200);const i=()=>{const e=["adj","type","name","head","body","weapon","legs"],t={};return s("/resources/dictionaries/enemies-dictionary.json").then(n=>new Promise(s=>{const r=JSON.parse(n).enemies;e.forEach(e=>((e,t,n)=>new Promise(s=>{let r;for(;!r;)(r=e[t][Math.round(Math.random()*e[t].length)])&&(n[t]=r,s(r))}))(r,e,t)),s(t)})).catch(e=>{throw new Error(e)})};var c=n(1);const l=()=>{return s("/resources/dictionaries/speech-dictionary.json").then(e=>new Promise(t=>{t(JSON.parse(e))})).then(e=>new Promise(t=>{let n;for(;!n;)(n=e[Math.round(Math.random()*e.length)])&&t(n.eng)})).catch(e=>{throw new Error(e)})},d=()=>{return s("/resources/dictionaries/languages-dictionary.json").then(e=>new Promise(t=>{t(JSON.parse(e))})).then(e=>new Promise(t=>{let n;for(;!n;)(n=e[Math.round(Math.random()*e.length)])&&t([n.eng,n.rus])})).catch(e=>{throw new Error(e)})};let u,h;class g{constructor(e,t,n,s){this.place={x:e*r.PX,y:t*r.PX},this.type=n,this.name=s||"John Smith",this.healPoints=r.MAX_HEAL_POINTS}redraw(){this.clearImage(),this.drawImage(),this.drawInfo(),this.drawHP()}drawName(e){let t=0;"enemy"===this.type?t=r.NAME_WRAP_ENEMY*r.PX:"player"===this.type&&(t=r.NAME_WRAP_PLAYER*r.PX),r.actorsContext.font=`${r.NAME_SIZE*r.PX}px Verdana`,r.actorsContext.fillStyle="red",r.actorsContext.textAlign="center",r.actorsContext.fillText(this.name,this.place.x-e*r.PX,this.place.y-t),r.actorsContext.fillStyle="black",r.actorsContext.textAlign="center",r.actorsContext.strokeText(this.name,this.place.x-e*r.PX,this.place.y-t)}drawHP(e){const t=this.healPoints/r.MAX_HEAL_POINTS;let n=0;"enemy"===this.type?n=r.HP_WRAP_ENEMY*r.PX:"player"===this.type&&(n=r.HP_WRAP_PLAYER*r.PX),r.actorsContext.fillStyle="red",r.actorsContext.fillRect(this.place.x-e*r.PX,this.place.y-n,t*this.image.width,r.HP_LINE_HEIGHT*r.PX),r.actorsContext.fillStyle="black",r.actorsContext.strokeRect(this.place.x-e*r.PX,this.place.y-n,this.image.width,r.HP_LINE_HEIGHT*r.PX)}rebuild(e,t){this.place={x:e,y:t},"enemy"===this.type?(this.image.width=r.ENEMY_WIDTH*r.PX,this.image.height=r.ENEMY_HEIGHT*r.PX):"player"===this.type&&(this.image.width=r.PLAYER_WIDTH*r.PX,this.image.height=r.PLAYER_HEIGHT*r.PX),this.redraw()}heal(e){r.spellContext.drawImage(e.image,this.place.x-this.image.width/4,this.place.y,e.width,e.height),this.healPoints<=r.MAX_HEAL_POINTS-r.HEAL?this.healPoints+=r.HEAL:this.healPoints=r.MAX_HEAL_POINTS,this.effect(),setTimeout(()=>{r.spellContext.clearRect(this.place.x-this.image.width/4,this.place.y,e.width,e.height)},500)}effect(e){this.clearImage(),setTimeout(()=>{this.clearImage(),this.redraw()},e)}damaged(){this.healPoints-r.ATTACK>0?(this.healPoints-=r.ATTACK,this.effect(r.EFFECT_DURATION)):this.loose()}}class m extends g{constructor(e,t,n,s,o,a){super(e,t,"enemy",o),this.image={head:a.head,body:a.body,weapon:a.weapon,legs:a.legs,width:s.width,height:s.height},this.healPoints=r.MAX_HEAL_POINTS,this.redraw()}drawInfo(){this.drawName(0),this.drawHP(this.image.width/3)}drawImage(){r.actorsContext.drawImage(this.image.legs,this.place.x-r.BODY_WIDTH*r.PX/6,this.place.y+r.BODY_HEIGHT*r.PX/1.5+r.HEAD_HEIGHT*r.PX/3,r.LEGS_WIDTH*r.PX,r.LEGS_HEIGHT*r.PX),r.actorsContext.drawImage(this.image.body,this.place.x-r.BODY_WIDTH*r.PX/3.5,this.place.y+r.HEAD_HEIGHT*r.PX/4,r.BODY_WIDTH*r.PX,r.BODY_HEIGHT*r.PX),r.actorsContext.drawImage(this.image.head,this.place.x-r.BODY_WIDTH*r.PX/50,this.place.y-r.HEAD_HEIGHT*r.PX/3,r.HEAD_WIDTH*r.PX,r.HEAD_HEIGHT*r.PX),r.actorsContext.drawImage(this.image.weapon,this.place.x-1.1*r.WEAPON_WIDTH*r.PX,this.place.y+(r.HEAD_HEIGHT*r.PX-r.WEAPON_HEIGHT/1.5*r.PX),r.WEAPON_WIDTH*r.PX,r.WEAPON_HEIGHT*r.PX)}loose(){h.win(),E()}clearImage(){r.actorsContext.clearRect(this.place.x-this.image.width/2,this.place.y,1.3*this.image.width,this.image.height)}}function E(){const e=new Image;e.width=r.ENEMY_WIDTH*r.PX,e.height=r.ENEMY_HEIGHT*r.PX,async function(){const e=await i(),t=`${e.adj} ${e.type} ${e.name}`,n=`${r.ENEMY_PATH}/head/head_${e.head}.png`,s=new Image;s.width=r.HEAD_WIDTH*r.PX,s.heigth=r.HEAD_HEIGHT*r.PX,s.src=n;const o=`${r.ENEMY_PATH}/torso/torso_${e.body}.png`,a=new Image;a.width=r.BODY_WIDTH*r.PX,a.heigth=r.BODY_HEIGHT*r.PX,a.src=o;const c=`${r.ENEMY_PATH}/weapon/weapon_${e.weapon}.png`,l=new Image;l.width=r.WEAPON_WIDTH*r.PX,l.heigth=r.WEAPON_HEIGHT*r.PX,l.src=c;const d=`${r.ENEMY_PATH}/legs/legs_${e.legs}.png`,u=new Image;return u.width=r.LEGS_WIDTH*r.PX,u.heigth=r.LEGS_HEIGHT*r.PX,u.src=d,[t,{head:s,body:a,weapon:l,legs:u}]}().then(([t,n])=>{u=new m(r.CANVAS_WIDTH-r.ENEMY_WIDTH-r.WRAP*r.PX,r.CANVAS_HEIGHT-r.ENEMY_HEIGHT-r.VERTICAL_WRAP*r.PX,"enemy",e,t,n)})}class p extends g{constructor(e,t,n,s,o){super(e,t,"player",o),this.score=0,this.image=s,this.redraw(),this.healPoints=r.MAX_HEAL_POINTS}drawImage(){r.actorsContext.drawImage(this.image,this.place.x,this.place.y,this.image.width,this.image.height)}drawInfo(){this.drawName(-this.image.width/3),this.drawHP(this.place.x/3),this.drawLevel()}drawLevel(){r.actorsContext.font=`${r.LVL_SIZE*r.PX}px Verdana`,r.actorsContext.fillStyle="orange",r.actorsContext.textAlign="center",r.actorsContext.fillText(this.score+1,r.CANVAS_WIDTH/2-this.score*r.PX,r.LVL_WRAP*r.PX+r.LVL_SIZE*r.PX)}win(){this.score+=1,E()}getTop(e,t,n){let s=t;return e.push(n),e.length<t&&(s=e.length),e.sort((e,t)=>t.score-e.score),[s,e]}createGameScoreList(e,t){const n=$("#gameWindow");n.append("<h3>Score List</h3>");const s=document.createElement("P");s.innerText=`Your Score: ${t.score}`,n.append(s);let o=r.TOP_COUNT;[o,e]=this.getTop(e,o,t);for(let t=0;t<o;t+=1){const s=document.createElement("h3");s.innerText=`${t+1}. ${e[t].name} ${e[t].score} `,n.append(s)}}loose(){const e=$("#gameWindow");$("#onlyLoggedUserContent")[0].style.display="none",e.toggleClass("main-game-container main-score-container bg-light");let t=[];localStorage.scoreAll&&(t=JSON.parse(localStorage.scoreAll));const n={name:this.name,score:this.score};this.createGameScoreList(t,n),e.append('<button class="btn btn-primary" onclick="location.reload();">Repeat?</button>'),localStorage.scoreAll=JSON.stringify(t),this.healPoints=r.MAX_HEAL_POINTS}clearImage(){r.actorsContext.clearRect(this.place.x,this.place.y,this.image.width,this.image.heigth)}}function _(){const e=JSON.parse(localStorage.getItem("user"));e&&e.gender&&e.name&&(!function(e,t){const n=new Image,s=`PLAYER_${e.toUpperCase()}_NUM`,o=Math.ceil(Math.random()*r[s]);n.src=`${r.PLAYER_PATH}/hero_${e}_${o}.png`,n.width=r.PLAYER_WIDTH*r.PX,n.height=r.PLAYER_HEIGHT*r.PX,h=new p(r.WRAP*r.PX,r.CANVAS_HEIGHT-r.PLAYER_HEIGHT-r.VERTICAL_WRAP*r.PX,"player",n,t)}(e.gender,e.name),E())}function P(e,t,n){!function(e){e.sound.loop=!0,e.sound.play()}(e);let s=function(e,t,n){let s=e.place.x;"player"===e.type&&(s+=e.image.width/2);"drop"===n.type&&(s=t.place.x);return s}(t,n,e),o=function(e,t){let n=e.place.y+e.image.height/4;"drop"===t.type&&(n=0);return n}(n,e),a=Math.abs(t.place.x-n.place.x+u.image.width/2+h.image.width/2);if("player"===t.type&&(a+=n.image.width/2),"heal"===e.type)t.heal(e),f(e);else{const i=setInterval(()=>{r.spellContext.clearRect(s,o,e.width*r.PX,e.height*r.PX),[s,o]=function(e,t,n,s,o){let a,i=e,c=t;a=e>=o-o/4?4:e>=o/2?3:e<=o/4?1:2;switch(s.type){case"flying":if(i>=o/2-o/12&&i<=o/2+o/12)c-=0;else if("enemy"===n.type)switch(a){case 1:c+=s.step.y*r.PX;break;case 2:c+=s.step.y*(r.PX/2);break;case 3:c-=s.step.y*(r.PX/2);break;case 4:c-=s.step.y*r.PX}else if("player"===n.type)switch(a){case 1:c-=s.step.y*r.PX;break;case 2:c-=s.step.y*(r.PX/2);break;case 3:c+=s.step.y*(r.PX/6);break;case 4:c+=s.step.y*(r.PX/2)}break;case"straight":c+=s.step.y*r.PX;break;case"jiggling":c+=s.step.y*r.PX,s.step.y*=-1;break;case"drop":c+=s.step.y*r.PX}"player"===n.type?i+=s.step.x:i-=s.step.x;return[i,c]}(s,o,t,e,a),r.spellContext.drawImage(e.image,s,o,e.width*r.PX,e.height*r.PX),"player"===t.type?s>=n.place.x&&o>=n.place.y&&A(e,n,i,s,o,r.spellContext):s<=n.place.x+n.image.width/2&&o>=n.place.y&&A(e,n,i,s,o,r.spellContext)},24)}}function A(e,t,n,s,o,a){!function(e,t){f(e),t.damaged()}(e,t),function(e,t=0,n=0,s,r,o){clearInterval(e),s.clearRect(t,n,r,o)}(n,s,o,a,e.width*r.PX,e.height*r.PX)}function y(){P(function(){const e=Math.floor(Math.random()*o.length);return o[e]}(),u,h)}function f(e){e.sound.pause(),e.sound.currentTime=0}function I(e,t,n){$("#userModalTaskContainer").empty(),$("#modalFooter").empty(),async function(e,t,n){let s,o,a,i;switch(r.TASKSLIST[Math.floor(Math.random()*r.TASKSLIST.length)]){case"counting":o="Count",s="number",[a,i]=Object(c.a)();break;case"translation":o="Translate",s="text",[a,i]=await d();break;case"speech":o="Write what you hear",s="text",a="",i=await l(),setTimeout(()=>{T(i)},r.SPEECH_DELATION),function(e){const t=document.createElement("button");t.setAttribute("class","btn btn-danger float-right"),t.setAttribute("id","repeatTask"),t.innerHTML="Repeat",t.addEventListener("click",()=>{T(e)}),document.getElementById("modalFooter").appendChild(t)}(i)}(function(e,t){const n=document.createElement("h3");n.setAttribute("id","taskQuiz"),n.innerText=`${e}: ${t}`,document.getElementById("userModalTaskContainer").appendChild(n)})(o,a),function(e){const t=document.createElement("input");t.classList.add("form-control"),t.setAttribute("id","userAnswer"),t.setAttribute("type",`${e}`),document.getElementById("userModalTaskContainer").appendChild(t),document.onkeypress=(()=>{document.getElementById("userAnswer").focus()})}(s),function(){const e=document.createElement("button");e.setAttribute("class","btn btn-primary float-left"),e.setAttribute("id","submitTask"),e.setAttribute("data-dismiss","modal"),e.innerHTML="Submit",document.getElementById("modalFooter").appendChild(e)}(),document.getElementById("submitTask").addEventListener("click",()=>{!function(e,t,n,s){const o=document.getElementById("userAnswer").value,a=document.getElementById("taskQuiz");a.style.color="red",e.toString().toLowerCase()===o.toLowerCase().trim()?(a.innerText="RIGHT!",setInterval(P(t,n,s),r.MODAL_DELATION)):(a.innerText=`WRONG! Answer is '${e}'`,setInterval(y(),r.MODAL_DELATION));a.style.color="black"}(i,e,t,n)}),document.getElementById("userAnswer").addEventListener("keyup",e=>{e.preventDefault(),e.keyCode===r.KEYBOARDEVENT.ENTER&&document.getElementById("submitTask").click()})}(e,t,n)}function T(e){const t=window.speechSynthesis;t.getVoices();const n=new SpeechSynthesisUtterance(e);n.lang="en-US",n.pitch=.7,t.speak(n)}_(),function(){const e=document.getElementById("spellMenu"),t=document.getElementById("healMenu");o.forEach(n=>{const s=function(e){const t=document.createElement("button");t.setAttribute("class","btn btn-primary btn-lg btn-block"),t.textContent=e.name;const n=e.image;return n.width=30*r.PX,n.height=30*r.PX,t.appendChild(n),t.setAttribute("data-toggle","modal"),t.setAttribute("data-target","#solveGameTaskModal"),t}(n);"heal"===n.type?(s.addEventListener("click",()=>{I(n,h,h)}),t.appendChild(s)):(s.addEventListener("click",()=>{I(n,h,u)}),e.appendChild(s))})}(),document.getElementById("loginSubmit").addEventListener("click",()=>{const e=document.getElementById("userName").value,t=Array.from(document.querySelectorAll(".user-gender")).filter(e=>e.checked)[0].value;e&&t&&(document.getElementsByClassName("game-menu")[0].style.display="block",function(e,t){const n=new H(e,t);n.name&&n.gender&&(localStorage.user=JSON.stringify(n),document.getElementById("onlyLoggedUserContent").style.display="block");_()}(e,t),$("#logInModal").modal("toggle"),window.location=`${window.location.href.split("?")[0]}?session=${Date.now()}`)});class H{constructor(e,t){this.name=e,this.gender=t}}window.onload=(()=>{document.getElementsByClassName("game-menu")[0].style.top=`-${r.CANVAS_HEIGHT}px`,localStorage.user?$("body").toggleClass("bg-secondary"):(document.getElementsByClassName("game-menu")[0].style.display="none",document.getElementById("logInModalOpener").click()),$("document").ready(()=>{setTimeout(()=>{$("#pageLoaderSpinnerElement").toggleClass("not-displayed"),$("#onlyLoggedUserContent").toggleClass("not-displayed"),$("body").toggleClass("bg-secondary")},200)})}),window.onresize=r.rebuildCanvas(),setInterval(()=>{r.rebuildCanvas(),document.getElementsByClassName("game-menu")[0].style.top=`-${r.CANVAS_HEIGHT}px`,u&&u.rebuild(r.CANVAS_WIDTH-u.image.width-r.WRAP*r.PX,r.CANVAS_HEIGHT-u.image.height-r.VERTICAL_WRAP*r.PX),h&&h.rebuild(r.WRAP,r.CANVAS_HEIGHT-h.image.height-r.VERTICAL_WRAP*r.PX)},500),document.getElementById("menu").addEventListener("click",()=>{document.getElementById("gameMenu").classList.toggle("hidden")})},function(e,t,n){e.exports=n(2)}]);