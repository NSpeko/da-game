!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";n.d(t,"M",function(){return w}),n.d(t,"y",function(){return W}),n.d(t,"F",function(){return J}),n.d(t,"s",function(){return D}),n.d(t,"B",function(){return K}),n.d(t,"u",function(){return q}),n.d(t,"C",function(){return G}),n.d(t,"l",function(){return C}),n.d(t,"a",function(){return N}),n.d(t,"h",function(){return B}),n.d(t,"D",function(){return O}),n.d(t,"E",function(){return j}),n.d(t,"t",function(){return R}),n.d(t,"G",function(){return H}),n.d(t,"K",function(){return v}),n.d(t,"H",function(){return T}),n.d(t,"N",function(){return a}),n.d(t,"L",function(){return s}),n.d(t,"e",function(){return o}),n.d(t,"A",function(){return l}),n.d(t,"d",function(){return d}),n.d(t,"v",function(){return u}),n.d(t,"n",function(){return h}),n.d(t,"w",function(){return g}),n.d(t,"m",function(){return m}),n.d(t,"f",function(){return p}),n.d(t,"q",function(){return f}),n.d(t,"r",function(){return y}),n.d(t,"z",function(){return b}),n.d(t,"x",function(){return A}),n.d(t,"i",function(){return _}),n.d(t,"g",function(){return x}),n.d(t,"k",function(){return I}),n.d(t,"j",function(){return E}),n.d(t,"c",function(){return k}),n.d(t,"b",function(){return L}),n.d(t,"J",function(){return $}),n.d(t,"I",function(){return M}),n.d(t,"p",function(){return P}),n.d(t,"o",function(){return S});const i=document.getElementById("spellCanvas"),a=i.getContext("2d"),r=document.getElementById("actors"),s=r.getContext("2d");let o=document.getElementById("gameWindow").offsetWidth;r.style.left=`-${o}px`;const c=()=>o/800;let l=c(),d=350;const u=25,h=55,g=15,m=10,p=50,f=50,y=10;function w(){o=document.getElementById("gameWindow").offsetWidth,l=c(),v=o/30,T=(d=350*l)/3,I=(_=1.5*(b=100*l))/2.5,E=(x=1.5*(A=100*l))/2.5,k=_,L=x/2,$=_/2,M=x/2,P=_/1.25,S=x/1.5,T=d/10,r.style.left=`-${o}px`,i.width=o,i.height=d,r.width=o,r.height=d}let b=150,A=150,_=1.5*b,x=1.5*A,I=_/2.5,E=x/2.5,k=_,L=x/2,$=_/2,M=x/2,P=_/1.5,S=x/3,v=o/15,T=d/10;const C=30,N=60,B="../resources/images/enemy",O="../resources/images/spell/",j="../resources/audio/spell/",R=300*l,H=10,W=1,J=["counting","translation","speech"],D=20,K=["-","+","*"],q=2e3,G=800},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return countingTask});var _constants__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0);const countingTask=()=>{const signArray=_constants__WEBPACK_IMPORTED_MODULE_0__.B,sign=signArray[~~(Math.random()*signArray.length)],firstNum=getRandomCountNum(_constants__WEBPACK_IMPORTED_MODULE_0__.s),secondNum=getRandomCountNum(_constants__WEBPACK_IMPORTED_MODULE_0__.s),task=`${firstNum} ${sign} ${secondNum}`,answer=eval(task);return[task,answer]},getRandomCountNum=e=>Math.round(Math.random()*e)},function(e,t,n){"use strict";n.r(t);const i=e=>new Promise(t=>{const n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(){200===this.status&&t(this.response)},n.send()});var a=n(0);let r=[];class s{constructor(e,t,n,i,s,o,c){this.name=e,this.image=new Image,this.image.src=`${a.D}${t}`,this.sound=new Audio(`${a.E}${n}`),this.width=i*a.A,this.height=s*a.A,this.step={x:o*a.A,y:c*a.A},r.push(this)}}new class extends s{constructor(e,t,n,i,a,r,s){super(e,t,n,i,a,r,s),this.type="flying"}}("Fireball","fireball.png","fireball.ogg",100,100,10,20),new class extends s{constructor(e,t,n,i,a,r,s){super(e,t,n,i,a,0,r),this.type="drop"}}("Meteor","meteor.png","meteor.ogg",200,200,12),new class extends s{constructor(e,t,n,i,a,r,s){super(e,t,n,i,a,r,0),this.type="straight"}}("Arrow","arrow.png","arrow.ogg",100,100,12),new class extends s{constructor(e,t,n,i,a,r,s){super(e,t,n,i,a,r,s),this.type="jiggling"}}("Star","star.png","star.ogg",100,100,12,8),new class extends s{constructor(e,t,n,i,a,r,s){super(e,t,n,i,a,0,0),this.type="heal"}}("Heal","heal.png","heal.ogg",200,200);const o=()=>{const e=["adj","type","name","head","body","weapon","legs"],t={};return i("/resources/dictionaries/enemies-dictionary.json").then(n=>new Promise(i=>{const a=JSON.parse(n).enemies;e.forEach(e=>((e,t,n)=>new Promise(i=>{let a;for(;!a;)(a=e[t][Math.round(Math.random()*e[t].length)])&&(n[t]=a,i(a))}))(a,e,t)),i(t)})).catch(e=>{throw new Error(e)})};var c=n(1);const l=()=>{return i("/resources/dictionaries/speech-dictionary.json").then(e=>new Promise(t=>{t(JSON.parse(e))})).then(e=>new Promise(t=>{let n;for(;!n;)(n=e[Math.round(Math.random()*e.length)])&&t(n.eng)})).catch(e=>{throw new Error(e)})};const d=()=>{return i("/resources/dictionaries/languages-dictionary.json").then(e=>new Promise(t=>{t(JSON.parse(e))})).then(e=>new Promise(t=>{let n;for(;!n;)(n=e[Math.round(Math.random()*e.length)])&&t([n.eng,n.rus])})).catch(e=>{throw new Error(e)})};let u,h;class g{constructor(e,t,n,i){this.place={x:e*a.A,y:t*a.A},this.type=n,this.name=i||"John Smith",this.healPoints=a.t}redraw(){this.clearImage(),this.drawImage(),this.drawInfo(),this.drawHP()}drawName(e){a.L.font=`${a.v*a.A}px Verdana`,a.L.fillStyle="black",a.L.textAlign="center",a.L.fillText(this.name,this.place.x-e*a.A,this.place.y-a.w*a.A)}drawHP(e){let t=this.healPoints/a.t;a.L.fillStyle="red",a.L.fillRect(this.place.x-e,this.place.y-a.n*a.A,t*this.image.width,a.m*a.A),a.L.fillStyle="black",a.L.strokeRect(this.place.x-e,this.place.y-a.n*a.A,this.image.width,a.m*a.A)}rebuild(e,t){this.place={x:e*a.A,y:t*a.A},this.redraw()}heal(e){a.N.drawImage(e.image,this.place.x-this.image.width/4,this.place.y,e.width,e.height),this.healPoints<=a.t-a.l?this.healPoints+=a.l:this.healPoints=a.t,this.effect(),setTimeout(()=>{a.N.clearRect(this.place.x-this.image.width/4,this.place.y,e.width,e.height)},500)}effect(e){this.clearImage(),setTimeout(()=>{this.clearImage(),this.redraw()},e)}damaged(){this.healPoints-a.a>0?(this.healPoints-=a.a,this.effect(a.f)):this.loose()}}class m extends g{constructor(e,t,n,i,r){super(e,t,"player",r),this.score=0,this.image=i,this.redraw(),this.healPoints=a.t}drawImage(){a.L.drawImage(this.image,this.place.x,this.place.y,this.image.width,this.image.height)}drawInfo(){this.drawName(-this.image.width/3),this.drawHP(this.place.x),this.drawLevel()}drawLevel(){a.L.font=`${a.q*a.A}px Verdana`,a.L.fillStyle="orange",a.L.textAlign="center",a.L.fillText(this.score+1,a.e/2-this.score*a.A,a.r*a.A+a.q*a.A)}win(){this.score+=1,f()}getTop(e,t,n){let i=t;return e.push(n),e.length<t&&(i=e.length),e.sort((e,t)=>t.score-e.score),[i,e]}createGameScoreList(e,t){const n=$("#gameWindow");n.append("<h3>Score List</h3>");let i=document.createElement("P");i.innerText=`Your Score: ${t.score}`,n.append(i);let r=a.G;[r,e]=this.getTop(e,r,t);for(let t=0;t<r;t+=1){let i=document.createElement("h3");i.innerText=`${t+1}. ${e[t].name} ${e[t].score} `,n.append(i)}}loose(){const e=$("#gameWindow");$("#onlyLoggedUserContent")[0].style.display="none",e.toggleClass("main-game-container main-score-container bg-light");let t=[];localStorage.scoreAll&&(t=JSON.parse(localStorage.scoreAll));const n={name:this.name,score:this.score};this.createGameScoreList(t,n),e.append('<button class="btn btn-primary" onclick="location.reload();">Repeat?</button>'),localStorage.scoreAll=JSON.stringify(t),this.healPoints=a.t}clearImage(){a.L.clearRect(this.place.x,this.place.y,this.image.width,this.image.heigth)}}class p extends g{constructor(e,t,n,i,r,s){super(e,t,"enemy",r),this.image={head:s.head,body:s.body,weapon:s.weapon,legs:s.legs,width:i.width,height:i.height},this.healPoints=a.t,this.redraw()}drawInfo(){this.drawName(this.name.length),this.drawHP(this.image.width/3)}drawImage(){a.L.drawImage(this.image.legs,this.place.x-a.c*a.A/6,this.place.y+a.b*a.A/1.5+a.j*a.A/3,this.image.legs.width,this.image.legs.heigth),a.L.drawImage(this.image.body,this.place.x-a.c*a.A/4.2,this.place.y+a.j*a.A/2,this.image.body.width,this.image.body.heigth),a.L.drawImage(this.image.head,this.place.x-a.c*a.A/50,this.place.y,this.image.head.width,this.image.head.heigth),a.L.drawImage(this.image.weapon,this.place.x-.9*a.J*a.A,this.place.y+a.j*a.A-a.I/2*a.A,this.image.weapon.width,this.image.weapon.heigth)}loose(){h.win(),f()}clearImage(){a.L.clearRect(this.place.x-this.image.width/2,this.place.y,1.3*this.image.width,this.image.height)}}function f(){const e=new Image;e.width=a.i*a.A,e.height=a.g*a.A,async function(){const e=await o(),t=`${e.adj} ${e.type} ${e.name}`,n=`${a.h}/head/head_${e.head}.png`;let i=new Image;i.width=a.k,i.heigth=a.j,i.src=n;const r=`${a.h}/torso/torso_${e.body}.png`;let s=new Image;s.width=a.c,s.heigth=a.b,s.src=r;const c=`${a.h}/weapon/weapon_${e.weapon}.png`;let l=new Image;l.width=a.J,l.heigth=a.I,l.src=c;const d=`${a.h}/legs/legs_${e.legs}.png`;let u=new Image;return u.width=a.p,u.heigth=a.o,u.src=d,[t,{head:i,body:s,weapon:l,legs:u}]}().then(([t,n])=>{u=new p(a.e-a.i-4*a.K,a.d-a.g-.8*a.H,"enemy",e,t,n)})}function y(){let e=JSON.parse(localStorage.getItem("user"));e&&e.gender&&e.name&&(!function(e,t){const n=new Image,i=Math.ceil(Math.random()*a.y);n.src=`../resources/images/player/hero_${e}_${i}.png`,n.width=a.z*a.A,n.height=a.x*a.A,h=new m(a.K/3,a.d-a.x-a.H,"player",n,t)}(e.gender,e.name),f())}function w(e,t,n){!function(e){e.sound.loop=!0,e.sound.play()}(e);let i=function(e,t,n){let i=e.place.x;"player"===e.type&&(i+=e.image.width/2);"drop"===n.type&&(i=t.place.x);return i}(t,n,e),r=function(e,t){let n=e.place.y+e.image.height/4;"drop"===t.type&&(n=0);return n}(n,e);const s=Math.abs(t.place.x-n.place.x+u.image.width/2+h.image.width/2);if("heal"===e.type)t.heal(e),_(e);else{let o=setInterval(function(){a.N.clearRect(i,r,e.width,e.height),[i,r]=function(e,t,n,i,a){let r,s=e,o=t;r=e>=a-a/4?4:e>=a/2?3:e<=a/4?1:2;switch(i.type){case"flying":if(s>=a/2-a/12&&s<=a/2+a/12)o-=0;else if("enemy"===n.type)switch(r){case 1:o+=i.step.y/2;break;case 2:o+=i.step.y/3;break;case 3:o-=i.step.y/3;break;case 4:o-=i.step.y/2}else if("player"===n.type)switch(r){case 1:o-=i.step.y/2;break;case 2:o-=i.step.y/3;break;case 3:o+=i.step.y/6;break;case 4:o+=i.step.y/3}break;case"straight":o+=i.step.y;break;case"jiggling":o+=i.step.y,i.step.y*=-1;break;case"drop":o+=i.step.y}"player"===n.type?s+=i.step.x:s-=i.step.x;return[s,o]}(i,r,t,e,s),a.N.drawImage(e.image,i,r,e.width,e.height),"player"===t.type?i>=n.place.x&&r>=n.place.y&&b(e,n,o,i,r,a.N):i<=n.place.x+n.image.width/2&&r>=n.place.y&&b(e,n,o,i,r,a.N)},24)}}function b(e,t,n,i,a,r){!function(e,t){_(e),t.damaged()}(e,t),function(e,t=0,n=0,i,a=canvasWidth,r=canvasHeight){clearInterval(e),i.clearRect(t,n,a,r)}(n,i,a,r,e.width,e.height)}function A(){w(function(){let e=~~(Math.random()*r.length);return r[e]}(),u,h)}function _(e){e.sound.pause(),e.sound.currentTime=0}function x(e,t,n){$("#userModalTaskContainer").empty(),$("#modalFooter").empty(),async function(e,t,n){let i,r,s,o;switch(a.F[~~(Math.random()*a.F.length)]){case"counting":r="Count",i="number",[s,o]=Object(c.a)();break;case"translation":r="Translate",i="text",[s,o]=await d();break;case"speech":r="Write what you hear",i="text",s="",o=await l(),setTimeout(function(){I(o)},a.C),function(e){const t=document.createElement("button");t.setAttribute("class","btn btn-danger float-right"),t.setAttribute("id","repeatTask"),t.innerHTML="Repeat",t.addEventListener("click",function(){I(e)}),document.getElementById("modalFooter").appendChild(t)}(o)}(function(e,t){const n=document.createElement("h3");n.setAttribute("id","taskQuiz"),n.innerText=`${e}: ${t}`,document.getElementById("userModalTaskContainer").appendChild(n)})(r,s),function(e){const t=document.createElement("input");t.classList.add("form-control"),t.setAttribute("id","userAnswer"),t.setAttribute("type",`${e}`),document.getElementById("userModalTaskContainer").appendChild(t)}(i),function(){const e=document.createElement("button");e.setAttribute("class","btn btn-primary float-left"),e.setAttribute("id","submitTask"),e.setAttribute("data-dismiss","modal"),e.innerHTML="Submit",document.getElementById("modalFooter").appendChild(e)}(),document.getElementById("submitTask").addEventListener("click",function(){!function(e,t,n,i){const r=document.getElementById("userAnswer").value,s=document.getElementById("taskQuiz");s.style.color="red",e==r?(s.innerText="RIGHT!",setInterval(w(t,n,i),a.u)):(s.innerText=`WRONG! Answer is '${e}'`,setInterval(A(),a.u));s.style.color="black"}(o,e,t,n)})}(e,t,n)}function I(e){const t=window.speechSynthesis;t.getVoices();const n=new SpeechSynthesisUtterance(e);t.speak(n)}y(),function(){const e=document.getElementById("spellMenu"),t=document.getElementById("healMenu");r.forEach(n=>{let i=function(e){let t=document.createElement("button");t.setAttribute("class","btn btn-primary btn-lg btn-block"),t.textContent=e.name;const n=e.image;return n.width=30*a.A,n.height=30*a.A,t.appendChild(n),t.setAttribute("data-toggle","modal"),t.setAttribute("data-target","#solveGameTaskModal"),t}(n);"heal"===n.type?(i.addEventListener("click",function(){x(n,h,h)}),t.appendChild(i)):(i.addEventListener("click",function(){x(n,h,u)}),e.appendChild(i))})}(),document.getElementById("loginSubmit").addEventListener("click",function(){!function(e,t){const n=new E(e,t);n.name&&n.gender&&(localStorage.user=JSON.stringify(n),document.getElementById("onlyLoggedUserContent").style.display="block");y()}(document.getElementById("userName").value,Array.from(document.querySelectorAll(".user-gender")).filter(e=>e.checked)[0].value),$("#logInModal").modal("toggle")});class E{constructor(e,t){this.name=e,this.gender=t}}window.onload=function(){document.getElementsByClassName("game-menu")[0].style.top="-"+a.d+"px",localStorage.user?$("body").toggleClass("bg-secondary"):document.getElementById("logInModalOpener").click(),$("document").ready(function(){setTimeout(function(){$("#pageLoaderSpinnerElement").toggleClass("not-displayed"),$("#onlyLoggedUserContent").toggleClass("not-displayed"),$("body").toggleClass("bg-secondary")},200)})},window.onresize=a.M(),setInterval(function(){a.M(),u&&u.rebuild(a.e*a.A-3.2*a.i*a.A-a.K*a.A,a.d*a.A-a.g*a.A-3.8*a.H*a.A),h&&h.rebuild(a.K*a.A/3,a.d*a.A-a.x*a.A-4.5*a.H*a.A)},500),document.getElementById("menu").addEventListener("click",function(){document.getElementById("gameMenu").classList.toggle("hidden")})},function(e,t,n){e.exports=n(2)}]);